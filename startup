#!/bin/sh
# IceWM startup file

# Helper for auto-restarting apps
auto_restart() {
    while true; do
        "$@"
        sleep 2
    done
}

# PolicyKit agent
if command -v lxpolkit >/dev/null 2>&1; then
    lxpolkit &
fi

# Picom compositor (auto-restart)
if command -v picom >/dev/null 2>&1; then
    auto_restart picom --config ~/.config/picom.conf &
fi

# Set random wallpaper
if [ -d "$HOME/.icewm/themes/IceWM-RedZen/backgrounds/artstation/" ]; then
    feh --randomize --bg-scale "$HOME/.icewm/themes/IceWM-RedZen/backgrounds/artstation/"*
fi

# Dunst (auto-restart)
if command -v dunst >/dev/null 2>&1; then
    auto_restart dunst &
fi

# System tray applets
if command -v nm-applet >/dev/null 2>&1; then
    nm-applet &
fi

if command -v blueman-applet >/dev/null 2>&1; then
    blueman-applet &
fi

# LXQt power manager
if command -v xfce4-power-manager >/dev/null 2>&1; then
    xfce4-power-manager &
fi

# Clipboard manager
if command -v clipit >/dev/null 2>&1; then
    clipit &
fi

# Night light (optional)
# if command -v redshift >/dev/null 2>&1; then
#     redshift -O 3500 &
# fi

# Conky
if command -v conky >/dev/null 2>&1; then
    conky &
fi

# USB automount (optional, udiskie is better)
if command -v udiskie >/dev/null 2>&1; then
    udiskie &
fi

# Screenshot daemon
if command -v flameshot >/dev/null 2>&1; then
    flameshot &
fi

exit 0
